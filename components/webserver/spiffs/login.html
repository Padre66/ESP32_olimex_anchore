<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Belépés</title>
<style>
  :root{--bg1:#071623;--bg2:#0b2236;--card:#0f1f2e;--muted:#7c8aa3;--text:#e8eef7;--accent:#2da8ff;--accent2:#57b6ff;--ok:#19c37d;--warn:#ffb020}
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;color:var(--text);
    font:14px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,sans-serif;
    background:
      radial-gradient(1100px 700px at 22% 28%, #0b2f58 0%, transparent 62%),
      radial-gradient(1100px 700px at 78% 62%, #0a2a49 0%, transparent 62%),
      linear-gradient(180deg, var(--bg1), var(--bg2)),
      repeating-linear-gradient(0deg, rgba(255,255,255,.03) 0 1px, transparent 1px 32px),
      repeating-linear-gradient(90deg, rgba(255,255,255,.03) 0 1px, transparent 1px 32px);
    background-blend-mode:screen,screen,normal,normal,normal;
  }
  .wrap{min-height:100svh;display:grid;place-items:center;padding:24px}
  .card{
    width:min(620px,92vw);
    background:color-mix(in srgb, var(--card) 92%, #000 8%);
    border:1px solid rgba(255,255,255,.06);
    border-radius:22px;box-shadow:0 18px 60px rgba(0,0,0,.45);
    padding:22px 22px 16px
  }
  .head{display:flex;align-items:center;gap:12px;margin-bottom:6px}
  .icon{width:34px;height:34px;border-radius:10px;background:linear-gradient(180deg,var(--accent),var(--accent2));display:grid;place-items:center;box-shadow:0 6px 20px rgba(45,168,255,.35)}
  .icon svg{width:20px;height:20px;fill:#00203a}
  h2{margin:0;font-size:18px}
  .sub{color:var(--muted);font-size:12px;margin:2px 0 14px}
  .row{display:flex;gap:10px}
  .col{flex:1}
  label{display:block;font-size:12px;color:var(--muted);margin:8px 2px 6px}
  input[type=text],input[type=password]{
    width:100%;padding:11px 12px;border-radius:12px;outline:0;
    border:1px solid rgba(255,255,255,.08);background:#0a1825;color:var(--text)
  }

  input::-ms-reveal,
  input::-ms-clear {
    display: none;
  }

  input::-webkit-credentials-auto-fill-button,
  input::-webkit-password-toggle-button {
    display: none !important;
  }

  input::-webkit-clear-button,
  input::-webkit-reveal {
    display: none !important;
  }

  .pwd{position:relative}
  .pwd input{padding-right:44px}
  .pwd .toggle{
    position:absolute;top:50%;right:12px;transform:translateY(-50%);
    width:36px;height:28px;display:grid;place-items:center;
    border:1px solid rgba(255,255,255,.18);background:#0a1825;color:#aeb7c6;
    border-radius:8px;cursor:pointer;padding:0
  }
  .pwd .toggle:hover{filter:brightness(1.15)}
  .pwd .toggle svg{width:18px;height:18px;opacity:.9}
  .btn{
    width:100%;margin:12px 0 10px;padding:11px 14px;border-radius:14px;border:0;cursor:pointer;
    background:linear-gradient(180deg,var(--accent),var(--accent2));color:#00203a;font-weight:800
  }
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px 10px;border-top:1px solid rgba(255,255,255,.06);font-size:12px}
  th{text-align:left;color:var(--muted);font-weight:600}
  .dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
  .ok{background:var(--ok)}.warn{background:var(--warn)}.off{background:#777}
  .foot{color:var(--muted);font-size:11px;text-align:center;margin-top:10px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="head">
        <div class="icon">
          <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2a2 2 0 0 1 2 2v1.1a7.9 7.9 0 0 1 4.9 4.9H20a2 2 0 1 1 0 4h-1.1a7.9 7.9 0 0 1-4.9 4.9V20a2 2 0 1 1-4 0v-1.1a7.9 7.9 0 0 1-4.9-4.9H4a2 2 0 1 1 0-4h1.1a7.9 7.9 0 0 1 4.9-4.9V4a2 2 0 0 1 2-2Zm0 6.5A5.5 5.5 0 1 0 17.5 14 5.5 5.5 0 0 0 12 8.5Z"/></svg>
        </div>
        <div>
          <h2>Belépés</h2>
          <div class="sub">Váró 1 IPS zóna master.</div>
        </div>
      </div>

      <div class="row">
        <div class="col">
          <label for="user">Felhasználónév</label>
          <input id="user" type="text" autocomplete="username" placeholder="pl. admin">
        </div>
      </div>

      <div class="col pwd">
        <label for="pwd">Jelszó</label>
        <input id="pwd" type="password" autocomplete="current-password" placeholder="••••••••">
        <button id="pwdToggle" class="toggle" type="button" aria-label="Jelszó megjelenítése" onclick="togglePwd()">
          <svg id="eyeIcon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Z"/>
            <circle cx="12" cy="12" r="2.5"/>
          </svg>
        </button>
      </div>

      <button class="btn" onclick="login()">Belépés</button>

      <div style="margin-top:10px;border-top:1px solid rgba(255,255,255,.06);padding-top:10px">
        <div class="sub" style="margin:0 0 6px">Anchor állapotok</div>
        <table>
          <tr><th>Anchor</th><th>ID</th><th>Utolsó mérés [s]</th><th>Feszültség [V]</th></tr>
          <tbody id="status-body"><tr><td colspan="4" class="sub">Töltés…</td></tr></tbody>
        </table>
      </div>

      <div class="foot" id="msg"></div>
    </div>
  </div>

<script>
function togglePwd(){
  const inp = document.getElementById('pwd');
  const eye = document.getElementById('eyeIcon');
  if (inp.type === 'password') {
    inp.type = 'text';
    eye.innerHTML = `
      <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Z"/>
      <circle cx="12" cy="12" r="2.5"/>
      <line x1="3" y1="3" x2="21" y2="21" stroke="currentColor" stroke-width="2"/>
    `;
  } else {
    inp.type = 'password';
    eye.innerHTML = `
      <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7Z"/>
      <circle cx="12" cy="12" r="2.5"/>
    `;
  }
}

async function loadStatus(){
  try{
    const r = await fetch('/api/status',{cache:'no-store'});
    if(!r.ok) throw 0;
    const s = await r.json(); // {anchor,id,last_s,last_v,state}
    const cls = s.state==='ok'?'ok':(s.state==='warn'?'warn':'off');
    document.getElementById('status-body').innerHTML =
      `<tr><td><span class="dot ${cls}"></span>${s.anchor}</td>
           <td>${s.id}</td>
           <td>${Number.isFinite(s.last_s)?s.last_s.toFixed(2):'-'}</td>
           <td>${Number.isFinite(s.last_v)?s.last_v.toFixed(2):'-'}</td></tr>`;
  }catch(e){
    document.getElementById('status-body').innerHTML =
      `<tr><td colspan="4" class="sub">Nem érhető el az állapot.</td></tr>`;
  }
}

async function login(){
  const user = document.getElementById('user').value.trim();
  const pass = document.getElementById('pwd').value;
  const msg = document.getElementById('msg');
  msg.textContent = '';
  try{
    const r = await fetch('/auth/login', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({user, pass})
    });
    if(!r.ok){ msg.textContent='Hibás felhasználónév vagy jelszó.'; return; }
    // Sütit beállította a szerver. Irány a szerep-oldal.
    // Minimál: BLE szerephez tervezted ezt az UI-t:
    window.location.href = '/super_user.html';
  }catch(e){
    msg.textContent='Hálózati hiba.';
  }
}

loadStatus();
setInterval(loadStatus,4000);
</script>
</body>
</html>
